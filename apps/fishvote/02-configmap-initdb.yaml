apiVersion: v1
kind: ConfigMap
metadata:
  name: fishvote-initdb
  namespace: fishvote
data:
  init.sql: |
    CREATE DATABASE IF NOT EXISTS fishvote;
    USE fishvote;
    
    CREATE TABLE IF NOT EXISTS fish (
      id INT PRIMARY KEY AUTO_INCREMENT,
      name VARCHAR(80) NOT NULL,
      tagline VARCHAR(255) NOT NULL,
      emoji VARCHAR(8) NOT NULL,
      image_url VARCHAR(255) NULL,
      votes INT NOT NULL DEFAULT 0
    );
    
    -- Insert only if empty
    INSERT INTO fish (name, tagline, emoji, image_url, votes)
    SELECT * FROM (
      SELECT 'Nemo',   'Small fish. Big main-character energy.',      'üê†', NULL, 0 UNION ALL
      SELECT 'Dory',   'Short-term memory, long-term legend.',         'üêü', NULL, 0 UNION ALL
      SELECT 'Jaws',   'Pure intimidation, zero apologies.',           'ü¶à', NULL, 0 UNION ALL
      SELECT 'Bruce',  'Friendly‚Ä¶ until you smell chum.',              'ü¶à', NULL, 0 UNION ALL
      SELECT 'Bubbles','Respect the bubbles.',                         'üê°', NULL, 0 UNION ALL
      SELECT 'Goldie', 'Classic. Reliable. Slightly judgy.',           'üêü', NULL, 0 UNION ALL
      SELECT 'Tuna',   'Fast. Serious. Protein-maxxing.',              'üêü', NULL, 0 UNION ALL
      SELECT 'Marlin', 'Anxious dad, heroic stamina.',                 'üê†', NULL, 0 UNION ALL
      SELECT 'Oscar',  'Talks too much, wins anyway.',                 'üê†', NULL, 0 UNION ALL
      SELECT 'Wanda',  'Regal, mysterious, and definitely plotting.',  'üê°', NULL, 0
    ) AS tmp
    WHERE NOT EXISTS (SELECT 1 FROM fish LIMIT 1);
